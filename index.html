<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ramadhan Tracker 2026</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f2027">
<style>
body{
  margin:0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:white;
  text-align:center;
}
h1{margin-top:20px;color:#FFD700}
.countdown{font-size:18px;margin:10px 0}
table{
  width:95%;
  margin:auto;
  border-collapse:collapse;
  background:rgba(255,255,255,0.05);
}
th,td{
  padding:8px;
  border:1px solid rgba(255,255,255,0.2);
  font-size:13px;
}
th{background:rgba(255,215,0,0.2)}
td.tap{cursor:pointer}
.gold{background:gold;color:black;font-weight:bold}
.red{background:#8B0000}
.note-icon{font-size:10px;color:#FFD700}
textarea{
  width:95%;
  margin-top:5px;
  border-radius:6px;
  border:none;
  padding:5px;
}
</style>
</head>
<body>

<h1>üåô Ramadhan 2026</h1>
<div class="countdown">
  ‚è≥ Imsak: <span id="imsakTimer"></span> |
  üåá Buka: <span id="bukaTimer"></span>
</div>

<table>
<thead>
<tr>
<th>Tgl</th>
<th>Puasa</th>
<th>Catatan Puasa</th>
<th>Tarawih & Tadarus</th>
</tr>
</thead>
<tbody id="calendar"></tbody>
</table>

<script>
const days = 30;
const calendar = document.getElementById("calendar");

for(let i=1;i<=days;i++){
  const row = document.createElement("tr");
  row.innerHTML=`
    <td>${i}</td>
    <td class="tap" data-type="puasa" data-day="${i}">-</td>
    <td><textarea placeholder="Catatan puasa..." id="note-puasa-${i}"></textarea></td>
    <td class="tap" data-type="ibadah" data-day="${i}">-</td>
  `;
  calendar.appendChild(row);
}

let tapCount={};

document.querySelectorAll(".tap").forEach(cell=>{
  cell.addEventListener("click",()=>{
    const key=cell.dataset.type+cell.dataset.day;
    tapCount[key]=(tapCount[key]||0)+1;

    if(tapCount[key]===1){
      cell.classList.toggle("gold");
      cell.textContent="‚úî";
    }

    if(tapCount[key]===3){
      const note=prompt("Tambahkan catatan:");
      if(note){
        cell.innerHTML="‚úî <span class='note-icon'>üìù</span>";
        localStorage.setItem("note-"+key,note);
      }
      tapCount[key]=0;
    }

    if(cell.dataset.type==="puasa" && !cell.classList.contains("gold")){
      cell.classList.add("red");
      cell.textContent="‚úò";
    }
  });
});

/* COUNTDOWN */
function updateCountdown(){
  const now=new Date();
  const imsak=new Date();
  const buka=new Date();

  imsak.setHours(4,30,0);
  buka.setHours(17,45,0);

  function diff(target){
    let t=target-now;
    if(t<0)t+=86400000;
    let h=Math.floor(t/3600000);
    let m=Math.floor((t%3600000)/60000);
    let s=Math.floor((t%60000)/1000);
    return `${h}j ${m}m ${s}d`;
  }

  document.getElementById("imsakTimer").textContent=diff(imsak);
  document.getElementById("bukaTimer").textContent=diff(buka);

  if(now.getHours()===4 && now.getMinutes()===30){
    notify("Waktu Imsak telah tiba");
  }
  if(now.getHours()===17 && now.getMinutes()===45){
    notify("Waktu Berbuka telah tiba");
    playAdzan();
  }
}

setInterval(updateCountdown,1000);

/* NOTIF */
function notify(text){
  if(Notification.permission==="granted"){
    new Notification(text);
  }
}
if(Notification.permission!=="granted"){
  Notification.requestPermission();
}

/* ADZAN SOUND */
function playAdzan(){
  const audio=new Audio("https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3");
  audio.play();
}

/* PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
