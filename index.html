<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Game Sejarah Dunia - Firebase</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .game-container { background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
    .question { font-size: 20px; }
    .answers button { display: block; margin: 10px 0; width: 100%; }
    .feedback { margin-top: 10px; font-weight: bold; }
    .score { margin-top: 20px; font-size: 18px; }
    .leaderboard { margin-top: 30px; }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="question" id="question">Loading...</div>
    <div class="answers" id="answers"></div>
    <div class="feedback" id="feedback"></div>
    <div class="score">Skor: <span id="score">0</span></div>

    <div class="leaderboard">
      <h3>Leaderboard:</h3>
      <ul id="leaderboard"></ul>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, query, limitToLast, orderByChild, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // GANTI DENGAN KONFIGURASI MILIKMU
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MSG_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    let currentUserUID = "";
    let score = 0;
    let currentQuestion = 0;

    const questions = [
      {
        question: "Siapa penemu mesin cetak modern pertama di Eropa?",
        options: ["Isaac Newton", "Leonardo da Vinci", "Johannes Gutenberg", "Galileo Galilei"],
        answer: "Johannes Gutenberg"
      },
      {
        question: "Apa nama tembok pertahanan terkenal di Tiongkok?",
        options: ["Tembok Merah", "Tembok Dinasti", "Tembok Raksasa", "Tembok Besar China"],
        answer: "Tembok Besar China"
      },
      {
        question: "Tahun berapa Perang Dunia II berakhir?",
        options: ["1945", "1939", "1918", "1950"],
        answer: "1945"
      },
      {
        question: "Siapa yang memimpin pasukan Makedonia?",
        options: ["Julius Caesar", "Napoleon Bonaparte", "Alexander Agung", "Genghis Khan"],
        answer: "Alexander Agung"
      }
    ];

    const questionEl = document.getElementById("question");
    const answersEl = document.getElementById("answers");
    const feedbackEl = document.getElementById("feedback");
    const scoreEl = document.getElementById("score");
    const leaderboardEl = document.getElementById("leaderboard");

    function showQuestion() {
      const q = questions[currentQuestion];
      questionEl.textContent = q.question;
      answersEl.innerHTML = "";
      feedbackEl.textContent = "";

      q.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(opt);
        answersEl.appendChild(btn);
      });
    }

    function checkAnswer(selected) {
      const correct = questions[currentQuestion].answer;
      if (selected === correct) {
        score += 10;
        feedbackEl.textContent = "Benar!";
        feedbackEl.style.color = "green";
      } else {
        score -= 5;
        feedbackEl.textContent = `Salah! Jawaban yang benar: ${correct}`;
        feedbackEl.style.color = "red";
      }

      scoreEl.textContent = score;
      currentQuestion = (currentQuestion + 1) % questions.length;

      setTimeout(() => {
        showQuestion();
      }, 2000);

      saveScore();
    }

    function saveScore() {
      if (!currentUserUID) return;
      const leaderboardRef = ref(db, "leaderboard");
      push(leaderboardRef, {
        uid: currentUserUID,
        score: score,
        time: new Date().toISOString()
      });
    }

    function loadLeaderboard() {
      const q = query(ref(db, "leaderboard"), orderByChild("score"), limitToLast(5));
      onValue(q, (snapshot) => {
        const data = [];
        snapshot.forEach(child => data.push(child.val()));
        data.sort((a, b) => b.score - a.score);

        leaderboardEl.innerHTML = "";
        data.forEach(entry => {
          const li = document.createElement("li");
          li.textContent = `${entry.score} poin - ${new Date(entry.time).toLocaleString()}`;
          leaderboardEl.appendChild(li);
        });
      });
    }

    // Mulai game setelah login anon
    signInAnonymously(auth)
      .then(cred => {
        currentUserUID = cred.user.uid;
        showQuestion();
        loadLeaderboard();
      })
      .catch(error => console.error(error));
  </script>
</body>
</html>
