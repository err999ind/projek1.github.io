<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KEYLLA VIRGINA ‚Äî Buku Tabungan</title>
<style>
:root{
  --bg:#fff0f7;--card:#ffe3f2;--accent:#ff6bd6;--muted:#b46ba1;--danger:#ff3366;
  font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
}
html,body{margin:0;padding:0;height:100%;background:linear-gradient(180deg,#ffb6f0,#ffd6f9,#fff0f7);color:#4a0044;overflow-x:hidden;}
.hidden{display:none;}
#pinScreen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#ff94dc,#ffd6f9);z-index:9999}
#pinBox{background:#fff0f7;padding:20px;border-radius:12px;text-align:center;box-shadow:0 6px 20px rgba(0,0,0,0.15)}
#pinBox input{font-size:20px;letter-spacing:8px;text-align:center;padding:10px;width:140px;border:1px solid #ff7ac6;border-radius:8px;margin-bottom:10px}
#pinBox button{padding:8px 14px;border:none;background:#ff6bd6;color:#fff;border-radius:8px;cursor:pointer}
#pinError{color:var(--danger);font-size:13px;height:16px;margin-top:6px}

/* Slides horizontal */
#slidesContainer{display:flex;flex-direction:row;transition:transform 0.3s ease;width:200vw;}
.slide{width:100vw;flex-shrink:0;min-height:100vh;box-sizing:border-box;padding:12px;overflow-y:auto;}
.card{background:var(--card);padding:12px;border-radius:10px;margin-top:12px;box-shadow:0 6px 15px rgba(0,0,0,0.1);border:1px solid rgba(255,0,180,0.2)}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
input,select,button{padding:8px;border-radius:8px;border:1px solid rgba(255,0,180,0.3);background:#fff;color:#4a0044;font-size:14px}
button{cursor:pointer;background:#ffb3e6;border:1px solid #ff7ac6;color:#4a0044}
.table{width:100%;border-collapse:collapse;margin-top:8px;max-height:250px;display:block;overflow-y:auto;}
.table th,.table td{font-size:13px;text-align:left;padding:6px;border-bottom:1px dashed rgba(255,0,180,0.3);}
.badge-income{color:#00b894;font-size:11px;padding:1px 4px;border-radius:4px;background:rgba(0,184,148,0.1);}
.badge-expense{color:var(--danger);font-size:11px;padding:1px 4px;border-radius:4px;background:rgba(255,51,102,0.1);}
.totals{font-weight:700;background:rgba(255,255,255,0.3);padding:6px;}
.small{font-size:12px;color:var(--muted);}
#navLeft,#navRight{position:fixed;top:50%;transform:translateY(-50%);background:var(--accent);color:#fff;border:none;padding:12px 14px;border-radius:50%;cursor:pointer;z-index:999;}
#navLeft{left:10px;} #navRight{right:10px;}
</style>
</head>
<body>

<!-- PIN Screen -->
<div id="pinScreen">
  <div id="pinBox">
    <h2>üîí MASUKAN PIN</h2>
    <input type="password" id="pinInput" maxlength="6" placeholder="******" inputmode="numeric">
    <br>
    <button id="pinBtn">BUKA</button>
    <div id="pinError"></div>
  </div>
</div>

<!-- Slides -->
<div id="app" class="hidden">
  <div id="slidesContainer">

    <!-- Slide 1 -->
    <div class="slide">
      <div class="header">
        <div class="title">Catatan Keuangan üéÄ</div>
        <div class="small">Pemasukan & Pengeluaran</div>
      </div>
      <div class="card row">
        <select id="kind" style="width:110px">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
        <input id="amount" type="number" step="0.01" min="0" placeholder="Jumlah">
        <input id="date" type="date">
        <input id="desc" type="text" placeholder="Deskripsi (opsional)">
        <button id="addBtn">Tambahkan</button>
        <button id="clearBtn1">Hapus Semua Slide 1</button>
      </div>
      <div class="card">
        <table class="table" id="entriesTable">
          <thead><tr><th>Tanggal</th><th>Tipe</th><th>Deskripsi</th><th>Jumlah</th><th>Edit</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr class="totals"><td colspan="3">Total</td><td id="totalAmount"></td><td></td></tr></tfoot>
        </table>
      </div>
    </div>

    <!-- Slide 2 -->
    <div class="slide">
      <div class="header">
        <div class="title">Tabungan üí∞</div>
        <div class="small">Pemasukan & Pengeluaran</div>
      </div>
      <div class="card row">
        <select id="kind2" style="width:110px">
          <option value="income">Pemasukan</option>
          <option value="expense">Pengeluaran</option>
        </select>
        <input id="amount2" type="number" step="0.01" min="0" placeholder="Jumlah">
        <input id="date2" type="date">
        <input id="desc2" type="text" placeholder="Deskripsi (opsional)">
        <button id="addBtn2">Tambahkan</button>
        <button id="clearBtn2">Hapus Semua Tabungan</button>
      </div>
      <div class="card">
        <table class="table" id="slide2Entries">
          <thead><tr><th>Tanggal</th><th>Tipe</th><th>Deskripsi</th><th>Jumlah</th><th>Edit</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr class="totals"><td colspan="3">Total</td><td id="slide2Total"></td><td></td></tr></tfoot>
        </table>
      </div>
    </div>

  </div>

  <button id="navLeft">‚Üê</button>
  <button id="navRight">‚Üí</button>
  <div class="card row">
    <button id="exportAllBtn">Export Semua Slide</button>
    <button id="importAllBtn">Import Semua Slide</button>
  </div>
</div>

<input type="file" id="fileInput" accept=".csv" style="display:none">

<script>
const PIN="060305";
let currentSlide=0;
const slidesContainer=document.getElementById("slidesContainer");
const totalSlides=document.querySelectorAll(".slide").length;
function nowISO(d=new Date()){ return d.toISOString().slice(0,10);}
function fmtCurrency(v){ return Number(v||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}
function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,7);}
function toast(msg){alert(msg);}

function loadEntries(){try{const raw=localStorage.getItem("glitch_money_entries_v1"); return raw?JSON.parse(raw):[];}catch(e){return[];}}
function saveEntries(list){try{localStorage.setItem("glitch_money_entries_v1",JSON.stringify(list));}catch(e){toast("Gagal simpan");}}
function loadTabungan(){try{const raw=localStorage.getItem("glitch_saving_v1"); return raw?JSON.parse(raw):[];}catch(e){return[];}}
function saveTabungan(list){try{localStorage.setItem("glitch_saving_v1",JSON.stringify(list));}catch(e){toast("Gagal simpan tabungan");}}

// PIN unlock
const pinScreen=document.getElementById("pinScreen");
const app=document.getElementById("app");
const pinInput=document.getElementById("pinInput");
const pinBtn=document.getElementById("pinBtn");
pinBtn.onclick=()=>{ if(pinInput.value===PIN){pinScreen.style.display="none"; app.classList.remove("hidden"); render(); renderSlide2();} else{alert("PIN salah"); pinInput.value="";}};

// Slide nav
function showSlide(idx){ currentSlide=Math.max(0,Math.min(idx,totalSlides-1)); slidesContainer.style.transform=`translateX(-${currentSlide*100}vw)`;}
document.getElementById("navLeft").onclick=()=>showSlide(currentSlide-1);
document.getElementById("navRight").onclick=()=>showSlide(currentSlide+1);

// Slide 1
const tbody=document.querySelector("#entriesTable tbody");
const totalEl=document.getElementById("totalAmount");
function render(){
  const list=loadEntries(); tbody.innerHTML=""; let total=0;
  list.forEach(it=>{
    const tr=document.createElement("tr");
    const kindBadge=it.kind==="income"?'<span class="badge-income">Pemasukan</span>':'<span class="badge-expense">Pengeluaran</span>';
    tr.innerHTML=`<td>${it.date||nowISO()}</td><td>${kindBadge}</td><td>${(it.description||"").slice(0,100)}</td><td>${fmtCurrency(it.amount)}</td><td><button data-id="${it.id}" class="editBtn">‚úèÔ∏è</button><button data-id="${it.id}" class="delBtn">üóëÔ∏è</button></td>`;
    tbody.appendChild(tr); total+=it.kind==="income"?Number(it.amount||0):-Number(it.amount||0);
  });
  totalEl.textContent=fmtCurrency(total);
  attachHandlers();
}
document.getElementById("addBtn").onclick=()=>{
  const kind=document.getElementById("kind").value;
  const amount=parseFloat(document.getElementById("amount").value);
  const date=document.getElementById("date").value||nowISO();
  const desc=document.getElementById("desc").value;
  if(isNaN(amount)||amount<=0){toast("Nominal >0");return;}
  const list=loadEntries();
  list.push({id:uid(),kind,amount,description:desc||"",date}); saveEntries(list); render();
  document.getElementById("amount").value=""; document.getElementById("desc").value="";
}
document.getElementById("clearBtn1").onclick=()=>{if(confirm("Yakin hapus semua Slide 1?")){saveEntries([]); render();}}

// Slide 2
const tbody2=document.querySelector("#slide2Entries tbody");
const total2=document.getElementById("slide2Total");
function renderSlide2(){
  const list=loadTabungan(); tbody2.innerHTML=""; let sum=0;
  list.forEach(it=>{
    const tr=document.createElement("tr");
    const kindBadge=it.kind==="income"?'<span class="badge-income">Pemasukan</span>':'<span class="badge-expense">Pengeluaran</span>';
    tr.innerHTML=`<td>${it.date||nowISO()}</td><td>${kindBadge}</td><td>${(it.description||"").slice(0,100)}</td><td>${fmtCurrency(it.amount)}</td><td><button data-id="${it.id}" class="editBtn2">‚úèÔ∏è</button><button data-id="${it.id}" class="delBtn2">üóëÔ∏è</button></td>`;
    tbody2.appendChild(tr); sum+=it.kind==="income"?Number(it.amount||0):-Number(it.amount||0);
  });
  total2.textContent=fmtCurrency(sum); attachHandlers2();
}
document.getElementById("addBtn2").onclick=()=>{
  const kind=document.getElementById("kind2").value;
  const amount=parseFloat(document.getElementById("amount2").value);
  const date=document.getElementById("date2").value||nowISO();
  const desc=document.getElementById("desc2").value;
  if(isNaN(amount)||amount<=0){toast("Nominal >0");return;}
  const list=loadTabungan();
  list.push({id:uid(),kind,amount,description:desc||"",date}); saveTabungan(list); renderSlide2();
  document.getElementById("amount2").value=""; document.getElementById("desc2").value="";
}
document.getElementById("clearBtn2").onclick=()=>{if(confirm("Yakin hapus semua Tabungan?")){saveTabungan([]); renderSlide2();}}

// Handlers edit/delete
function attachHandlers(){
  document.querySelectorAll(".delBtn").forEach(b=>{b.onclick=()=>{const id=b.dataset.id; const list=loadEntries().filter(x=>x.id!==id); saveEntries(list); render();}});
  document.querySelectorAll(".editBtn").forEach(b=>{b.onclick=()=>{const id=b.dataset.id; const list=loadEntries().find(x=>x.id===b.dataset.id)?loadEntries():[]; const it=list.find(x=>x.id===id); if(!it)return; const d=prompt("Ubah deskripsi",it.description||""); if(d===null)return; const a=parseFloat(prompt("Ubah jumlah",it.amount)); if(isNaN(a)||a<0)return; it.description=d; it.amount=a; saveEntries(list); render();}});
}
function attachHandlers2(){
  document.querySelectorAll(".delBtn2").forEach(b=>{b.onclick=()=>{const id=b.dataset.id; const list=loadTabungan().filter(x=>x.id!==id); saveTabungan(list); renderSlide2();}});
  document.querySelectorAll(".editBtn2").forEach(b=>{b.onclick=()=>{const id=b.dataset.id; const list=loadTabungan(); const it=list.find(x=>x.id===id); if(!it)return; const d=prompt("Ubah deskripsi",it.description||""); if(d===null)return; const a=parseFloat(prompt("Ubah jumlah",it.amount)); if(isNaN(a)||a<0)return; it.description=d; it.amount=a; saveTabungan(list); renderSlide2();}});
}

// Export / Import semua slide
const exportAllBtn=document.getElementById("exportAllBtn");
const importAllBtn=document.getElementById("importAllBtn");
const fileInput=document.getElementById("fileInput");
exportAllBtn.onclick=()=>{
  const list1=loadEntries().map(r=>({...r,slide:1}));
  const list2=loadTabungan().map(r=>({...r,slide:2}));
  const all=[...list1,...list2]; if(!all.length){toast("Tidak ada data"); return;}
  const header=["slide","id","kind","amount","description","date"];
  const rows=[header,...all.map(r=>[r.slide,r.id,r.kind,r.amount,r.description||"",r.date])];
  const csv=rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob=new Blob([csv],{type:"text/csv"}); const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="glitch-money-all.csv"; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  toast("Export semua slide berhasil!");
}
importAllBtn.onclick=()=>fileInput.click();
fileInput.onchange=async e=>{
  const f=e.target.files[0]; if(!f) return;
  const txt=await f.text();
  const lines=txt.split(/\r?\n/).filter(Boolean);
  if(lines.length<2){toast("File kosong"); return;}
  const parsed=lines.slice(1).map(l=>{
    const cols=l.match(/("([^"]|"")*"|[^,]+)/g)||[];
    const clean=cols.map(c=>c.replace(/^"|"$/g,"").replace(/""/g,'"'));
    return {slide:clean[0],id:clean[1]||uid(),kind:(clean[2]||"income").trim(),amount:Number(parseFloat(clean[3]||0)||0),description:clean[4]||"",date:clean[5]||nowISO()};
  }).filter(r=>r&&!Number.isNaN(r.amount));
  const list1=parsed.filter(r=>r.slide=="1").map(({slide,...rest})=>rest);
  const list2=parsed.filter(r=>r.slide=="2").map(({slide,...rest})=>rest);
  saveEntries(loadEntries().concat(list1));
  saveTabungan(loadTabungan().concat(list2));
  render(); renderSlide2();
  toast("Import semua slide selesai!");
  fileInput.value="";
}
</script>
</body>
</html>
